<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>drop-host-soft - Dokumentacja Skryptu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }
        .content {
            padding: 40px;
        }
        .section {
            margin-bottom: 50px;
        }
        .section-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .section-header h2 {
            font-size: 1.8em;
        }
        .section-description {
            background: #f0fff4;
            border-left: 5px solid #28a745;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 10px;
            line-height: 1.7;
            color: #333;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 5px;
            line-height: 1.6;
        }
        .info-box strong {
            color: #2196F3;
            display: block;
            margin-bottom: 8px;
        }
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 5px;
            color: #155724;
            line-height: 1.6;
        }
        .success-box strong {
            display: block;
            margin-bottom: 8px;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 5px;
            color: #856404;
            line-height: 1.6;
        }
        .warning-box strong {
            display: block;
            margin-bottom: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        thead {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95em;
        }
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        tbody tr:hover {
            background: #f8f9fa;
        }
        tbody tr:last-child td {
            border-bottom: none;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            margin: 20px 0;
        }
        .code-block code {
            display: block;
            white-space: pre;
        }
        .comment {
            color: #6a9955;
        }
        .keyword {
            color: #569cd6;
        }
        .string {
            color: #ce9178;
        }
        .flow-step {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .flow-step strong {
            color: #28a745;
            display: block;
            margin-bottom: 8px;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
        }
        .comparison-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
        }
        .comparison-card h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }
        .comparison-card.soft {
            border-color: #28a745;
        }
        .comparison-card.hard {
            border-color: #dc3545;
        }
        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 2px;
        }
        .tag-safe {
            background: #d4edda;
            color: #155724;
        }
        .tag-destructive {
            background: #f8d7da;
            color: #721c24;
        }
        .footer {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            color: #666;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üßπ drop-host-soft</h1>
            <p>MikroTik Script - Czyszczenie wpis√≥w bez blokowania</p>
        </div>

        <!-- Content -->
        <div class="content">

            <!-- Section 1: Overview -->
            <div class="section">
                <div class="section-header">
                    <h2>1Ô∏è‚É£ Opis dzia≈Çania</h2>
                </div>
                
                <div class="section-description">
                    <strong>drop-host-soft</strong> to "≈Çagodna" wersja drop-host-v2, kt√≥ra 
                    <strong>tylko czy≈õci wpisy routera</strong> bez dodawania permanent block. 
                    Idealny do czyszczenia po zez≈Çomowaniu/usuniƒôciu urzƒÖdze≈Ñ z sieci.
                </div>

                <div class="success-box">
                    <strong>‚úÖ BEZPIECZNA OPERACJA - Nie blokuje urzƒÖdzenia!</strong>
                    Ten skrypt <strong>NIE dodaje bridge filter</strong>, wiƒôc urzƒÖdzenie mo≈ºe 
                    ponownie po≈ÇƒÖczyƒá siƒô do sieci (je≈õli fizycznie istnieje). U≈ºywaj gdy:<br>
                    ‚Ä¢ UsunƒÖ≈Çe≈õ komputer z sieci (zez≈Çomowanie, przekazanie)<br>
                    ‚Ä¢ Wymieni≈Çe≈õ urzƒÖdzenie na nowe<br>
                    ‚Ä¢ Chcesz wyczy≈õciƒá stare wpisy DHCP/ARP<br>
                    ‚Ä¢ Troubleshooting - refresh wszystkich cache bez disconnect<br>
                    ‚Ä¢ Maintenance - czyszczenie nieaktywnych entries
                </div>

                <div class="info-box">
                    <strong>‚ÑπÔ∏è Kluczowe cechy:</strong>
                    ‚Ä¢ <strong>Non-destructive:</strong> Nie blokuje urzƒÖdzenia permanentnie<br>
                    ‚Ä¢ <strong>Cache cleanup:</strong> Usuwa ARP, DHCP, bridge host, conntrack<br>
                    ‚Ä¢ <strong>Flexible input:</strong> Dzia≈Ça z MAC address LUB IP address<br>
                    ‚Ä¢ <strong>Safe for production:</strong> Nie przerywa ruchu innych urzƒÖdze≈Ñ<br>
                    ‚Ä¢ <strong>Comprehensive logging:</strong> Pe≈Çne logowanie wszystkich akcji
                </div>

                <h3 style="margin: 30px 0 15px 0; color: #28a745;">üîÑ drop-host-soft vs drop-host-v2</h3>

                <div class="comparison-grid">
                    <div class="comparison-card soft">
                        <h3 style="color: #28a745;">üßπ drop-host-soft</h3>
                        <p><span class="tag tag-safe">BEZPIECZNY</span></p>
                        <ul style="margin-top: 15px; line-height: 1.8;">
                            <li>‚úÖ Czy≈õci ARP entries</li>
                            <li>‚úÖ Czy≈õci DHCP leases</li>
                            <li>‚úÖ Czy≈õci bridge host table</li>
                            <li>‚úÖ Czy≈õci conntrack sessions</li>
                            <li><strong>‚ùå NIE dodaje bridge filter</strong></li>
                        </ul>
                        <p style="margin-top: 15px; font-weight: bold; color: #28a745;">
                            ‚Üí UrzƒÖdzenie mo≈ºe ponownie siƒô po≈ÇƒÖczyƒá
                        </p>
                    </div>

                    <div class="comparison-card hard">
                        <h3 style="color: #dc3545;">üö´ drop-host-v2</h3>
                        <p><span class="tag tag-destructive">DESTRUCTIVE</span></p>
                        <ul style="margin-top: 15px; line-height: 1.8;">
                            <li>‚úÖ Czy≈õci ARP entries</li>
                            <li>‚úÖ Czy≈õci DHCP leases</li>
                            <li>‚úÖ Czy≈õci bridge host table</li>
                            <li>‚úÖ Czy≈õci conntrack sessions</li>
                            <li><strong>‚úÖ DODAJE bridge filter DROP</strong></li>
                        </ul>
                        <p style="margin-top: 15px; font-weight: bold; color: #dc3545;">
                            ‚Üí UrzƒÖdzenie permanentnie zablokowane
                        </p>
                    </div>
                </div>
            </div>

            <!-- Section 2: How it works -->
            <div class="section">
                <div class="section-header">
                    <h2>2Ô∏è‚É£ Jak dzia≈Ça - 4 fazy czyszczenia</h2>
                </div>

                <div class="section-description">
                    Script wykonuje <strong>4 fazy czyszczenia</strong> (bez fazy E - permanent block).
                </div>

                <h3 style="margin: 30px 0 15px 0; color: #28a745;">üìã Fazy dzia≈Çania</h3>

                <div class="flow-step">
                    <strong>Faza 0: Rozpoznanie celu</strong>
                    ‚Ä¢ Input: MAC address (np. <code>34:29:8F:74:EC:46</code>) LUB IP address (np. <code>10.110.110.22</code>)<br>
                    ‚Ä¢ Je≈õli podano MAC ‚Üí szuka IP w DHCP leases<br>
                    ‚Ä¢ Je≈õli podano IP ‚Üí szuka MAC w DHCP leases lub bridge host table<br>
                    ‚Ä¢ Wynik: <code>foundIP</code> i <code>foundMAC</code>
                </div>

                <div class="flow-step">
                    <strong>Faza A: Usuniƒôcie wpis√≥w ARP</strong>
                    ‚Ä¢ Usuwa wpisy ARP dla IP address<br>
                    ‚Ä¢ Usuwa wpisy ARP dla MAC address<br>
                    ‚Ä¢ Cel: Router "zapomina" o urzƒÖdzeniu na poziomie L3 cache
                </div>

                <div class="flow-step">
                    <strong>Faza B: Usuniƒôcie DHCP leases</strong>
                    ‚Ä¢ Usuwa DHCP lease dla MAC address<br>
                    ‚Ä¢ Usuwa DHCP lease dla IP address<br>
                    ‚Ä¢ Cel: Zwolnienie adresu IP w puli DHCP
                </div>

                <div class="flow-step">
                    <strong>Faza C: Usuniƒôcie bridge host entries (L2)</strong>
                    ‚Ä¢ Usuwa wpis bridge host dla MAC address<br>
                    ‚Ä¢ Usuwa wpis bridge host dla IP address<br>
                    ‚Ä¢ Cel: Router "zapomina" o urzƒÖdzeniu w L2 forwarding table
                </div>

                <div class="flow-step">
                    <strong>Faza D: Usuniƒôcie conntrack sessions (NAT/firewall)</strong>
                    ‚Ä¢ Usuwa aktywne connection tracking entries dla source IP<br>
                    ‚Ä¢ Usuwa aktywne connection tracking entries dla destination IP<br>
                    ‚Ä¢ Cel: Przerywa wszystkie aktywne sesje TCP/UDP (je≈õli urzƒÖdzenie jeszcze online)
                </div>

                <div class="success-box">
                    <strong>‚úÖ Brak fazy E - permanent block!</strong>
                    W przeciwie≈Ñstwie do drop-host-v2, ten skrypt <strong>NIE dodaje bridge filter</strong>. 
                    Je≈õli urzƒÖdzenie jest nadal fizycznie pod≈ÇƒÖczone, mo≈ºe ponownie uzyskaƒá DHCP lease 
                    i po≈ÇƒÖczyƒá siƒô do sieci. To jest po≈ºƒÖdane zachowanie dla maintenance operations.
                </div>
            </div>

            <!-- Section 3: Usage -->
            <div class="section">
                <div class="section-header">
                    <h2>3Ô∏è‚É£ U≈ºycie skryptu</h2>
                </div>

                <div class="section-description">
                    Script wymaga ustawienia zmiennej globalnej <code>HOSTID</code> z MAC lub IP urzƒÖdzenia.
                </div>

                <h3 style="margin: 30px 0 15px 0; color: #28a745;">üìù Przyk≈Çady u≈ºycia</h3>

                <div class="code-block">
                    <code><span class="comment"># Przyk≈Çad 1: Czyszczenie po zez≈Çomowanym PC (MAC)</span>
<span class="keyword">:global</span> HOSTID <span class="string">"34:29:8F:74:EC:46"</span>
<span class="keyword">/system script run</span> drop-host-soft

<span class="comment"># Przyk≈Çad 2: Czyszczenie po usuniƒôtym urzƒÖdzeniu (IP)</span>
<span class="keyword">:global</span> HOSTID <span class="string">"10.110.110.22"</span>
<span class="keyword">/system script run</span> drop-host-soft

<span class="comment"># Przyk≈Çad 3: Maintenance - czyszczenie starych wpis√≥w</span>
<span class="keyword">:global</span> HOSTID <span class="string">"D8:3A:DD:ED:7F:1B"</span>
<span class="keyword">/system script run</span> drop-host-soft

<span class="comment"># Przyk≈Çad 4: Troubleshooting - refresh cache bez disconnect</span>
<span class="keyword">:global</span> HOSTID <span class="string">"10.170.170.55"</span>
<span class="keyword">/system script run</span> drop-host-soft</code>
                </div>

                <h3 style="margin: 30px 0 15px 0; color: #28a745;">üìä Output przyk≈Çadowy</h3>

                <div class="code-block">
                    <code><span class="comment"># Po uruchomieniu skryptu zobaczysz:</span>
drop-host-soft: cel=34:29:8F:74:EC:46 -> IP=10.110.110.22, MAC=34:29:8F:74:EC:46
drop-host-soft: ARP usuniƒôty dla IP 10.110.110.22
drop-host-soft: ARP usuniƒôty dla MAC 34:29:8F:74:EC:46
drop-host-soft: lease DHCP usuniƒôty (MAC) 34:29:8F:74:EC:46
drop-host-soft: bridge-host usuniƒôty dla MAC 34:29:8F:74:EC:46
drop-host-soft: bridge-host usuniƒôty dla IP 10.110.110.22
drop-host-soft: conntrack rm src=10.110.110.22
drop-host-soft: conntrack rm dst=10.110.110.22
drop-host-soft: OK -> IP=10.110.110.22, MAC=34:29:8F:74:EC:46 (SOFT - bez blokady)</code>
                </div>

                <div class="info-box">
                    <strong>‚ÑπÔ∏è Co siƒô stanie z urzƒÖdzeniem?</strong>
                    <strong>Je≈õli urzƒÖdzenie jest OFFLINE (zez≈Çomowane):</strong><br>
                    ‚Ä¢ Wpisy sƒÖ wyczyszczone z routera<br>
                    ‚Ä¢ Adres IP jest zwolniony w puli DHCP<br>
                    ‚Ä¢ Nic wiƒôcej siƒô nie dzieje<br>
                    <br>
                    <strong>Je≈õli urzƒÖdzenie jest ONLINE (nadal pod≈ÇƒÖczone):</strong><br>
                    ‚Ä¢ Aktywne po≈ÇƒÖczenia sƒÖ przerywane (conntrack flush)<br>
                    ‚Ä¢ Po kilku sekundach urzƒÖdzenie odnowi DHCP lease<br>
                    ‚Ä¢ UrzƒÖdzenie dostanie ten sam lub nowy IP (z puli)<br>
                    ‚Ä¢ Po≈ÇƒÖczenie zostanie przywr√≥cone automatycznie
                </div>
            </div>

            <!-- Section 4: Use Cases -->
            <div class="section">
                <div class="section-header">
                    <h2>4Ô∏è‚É£ Przypadki u≈ºycia</h2>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Scenariusz</th>
                            <th>Opis</th>
                            <th>Dlaczego drop-host-soft?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>üóëÔ∏è Zez≈Çomowanie PC</strong></td>
                            <td>Komputer zosta≈Ç zez≈Çomowany lub przekazany</td>
                            <td>Czy≈õci wpisy routera, zwalnia IP w puli DHCP</td>
                        </tr>
                        <tr>
                            <td><strong>üîÑ Wymiana urzƒÖdzenia</strong></td>
                            <td>Stary PC wymieniony na nowy</td>
                            <td>Usuwa stare wpisy przed dodaniem nowego urzƒÖdzenia</td>
                        </tr>
                        <tr>
                            <td><strong>üßπ Maintenance cleanup</strong></td>
                            <td>Regularne czyszczenie nieaktywnych entries</td>
                            <td>Utrzymuje routing table clean bez blokowania</td>
                        </tr>
                        <tr>
                            <td><strong>üîß Troubleshooting</strong></td>
                            <td>Problemy z cache (stale ARP, bad conntrack)</td>
                            <td>Refresh cache bez przerywania dostƒôpu</td>
                        </tr>
                        <tr>
                            <td><strong>üìã Inventory audit</strong></td>
                            <td>Czyszczenie wpis√≥w nieistniejƒÖcych urzƒÖdze≈Ñ</td>
                            <td>Synchronizacja router entries z rzeczywistym stanem</td>
                        </tr>
                        <tr>
                            <td><strong>üîÑ DHCP pool cleanup</strong></td>
                            <td>Zwolnienie adres√≥w IP dla nowych urzƒÖdze≈Ñ</td>
                            <td>Zapobiega wyczerpaniu puli DHCP</td>
                        </tr>
                    </tbody>
                </table>

                <div class="success-box">
                    <strong>‚úÖ Best Practices:</strong>
                    ‚Ä¢ <strong>Przed usuniƒôciem:</strong> Uruchom drop-host-soft PRZED fizycznym usuniƒôciem urzƒÖdzenia<br>
                    ‚Ä¢ <strong>Inventory sync:</strong> Synchronizuj z systemem inventory management<br>
                    ‚Ä¢ <strong>Regular cleanup:</strong> Planuj regularne czyszczenie (co miesiƒÖc/kwarta≈Ç)<br>
                    ‚Ä¢ <strong>Documentation:</strong> Notuj usuniƒôte urzƒÖdzenia w asset management<br>
                    ‚Ä¢ <strong>Verify:</strong> Sprawd≈∫ DHCP leases przed i po czyszczeniu
                </div>
            </div>

            <!-- Section 5: Comparison -->
            <div class="section">
                <div class="section-header">
                    <h2>5Ô∏è‚É£ Kiedy u≈ºyƒá kt√≥rego skryptu?</h2>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Sytuacja</th>
                            <th>drop-host-soft</th>
                            <th>drop-host-v2</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Zez≈Çomowanie PC</strong></td>
                            <td style="background: #d4edda;">‚úÖ <strong>TAK</strong></td>
                            <td style="background: #f8d7da;">‚ùå Nie (overkill)</td>
                        </tr>
                        <tr>
                            <td><strong>Wymiana urzƒÖdzenia</strong></td>
                            <td style="background: #d4edda;">‚úÖ <strong>TAK</strong></td>
                            <td style="background: #f8d7da;">‚ùå Nie</td>
                        </tr>
                        <tr>
                            <td><strong>Maintenance cleanup</strong></td>
                            <td style="background: #d4edda;">‚úÖ <strong>TAK</strong></td>
                            <td style="background: #f8d7da;">‚ùå Nie</td>
                        </tr>
                        <tr>
                            <td><strong>Security incident</strong></td>
                            <td style="background: #f8d7da;">‚ùå Nie (za s≈Çaby)</td>
                            <td style="background: #d4edda;">‚úÖ <strong>TAK</strong></td>
                        </tr>
                        <tr>
                            <td><strong>Malware infection</strong></td>
                            <td style="background: #f8d7da;">‚ùå Nie</td>
                            <td style="background: #d4edda;">‚úÖ <strong>TAK</strong></td>
                        </tr>
                        <tr>
                            <td><strong>Unauthorized device</strong></td>
                            <td style="background: #f8d7da;">‚ùå Nie</td>
                            <td style="background: #d4edda;">‚úÖ <strong>TAK</strong></td>
                        </tr>
                        <tr>
                            <td><strong>Troubleshooting cache</strong></td>
                            <td style="background: #d4edda;">‚úÖ <strong>TAK</strong></td>
                            <td style="background: #fff3cd;">‚ö†Ô∏è Overkill</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Regu≈Ça wyboru:</strong>
                    ‚Ä¢ <strong>drop-host-soft:</strong> Gdy urzƒÖdzenie jest usuwane/wymieniane (normalny lifecycle)<br>
                    ‚Ä¢ <strong>drop-host-v2:</strong> Gdy urzƒÖdzenie jest zagro≈ºeniem bezpiecze≈Ñstwa (security incident)
                </div>
            </div>

            <!-- Section 6: Installation -->
            <div class="section">
                <div class="section-header">
                    <h2>6Ô∏è‚É£ Instalacja skryptu</h2>
                </div>

                <div class="code-block">
                    <code><span class="comment"># Dodaj skrypt drop-host-soft do MikroTik</span>
<span class="keyword">/system script add</span> name=drop-host-soft policy=\
ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source="\
:global HOSTID;\r\
:if ([:len \$HOSTID] = 0) do={ :log error \"drop-host-soft: ustaw najpierw :global HOSTID \\\"MAC lub IP\\\"\"; :put \"U≈ºycie: :global HOSTID \\\"34:29:8F:74:EC:46\\\"; /system script run drop-host-soft\"; :return }\r\
\r\
:local target \$HOSTID;\r\
:local isMac false;\r\
:if ([:find \$target \":\"] != -1) do={ :set isMac true; :set target [:toupper \$target] }\r\
\r\
:local foundIP \"\";\r\
:local foundMAC \"\";\r\
\r\
<span class="comment"># Rozpoznaj po MAC albo IP</span>\r\
:if (\$isMac = true) do={\r\
  :set foundMAC \$target;\r\
  :local lId [/ip dhcp-server lease find mac-address=\$foundMAC];\r\
  :if ([:len \$lId] > 0) do={ :set foundIP [/ip dhcp-server lease get \$lId address] }\r\
} else={\r\
  :set foundIP \$target;\r\
  :local lId2 [/ip dhcp-server lease find address=\$foundIP];\r\
  :if ([:len \$lId2] > 0) do={ :set foundMAC [/ip dhcp-server lease get \$lId2 mac-address] } else={\r\
    :local bh [/interface bridge host find where address=\$foundIP];\r\
    :if ([:len \$bh] > 0) do={ :set foundMAC [/interface bridge host get \$bh mac-address] }\r\
  }\r\
}\r\
\r\
:log info (\"drop-host-soft: cel=\" . \$HOSTID . \" -> IP=\" . \$foundIP . \", MAC=\" . \$foundMAC);\r\
\r\
<span class="comment"># A) ARP</span>\r\
:if ([:len \$foundIP] > 0) do={ :local a1 [/ip arp find where address=\$foundIP]; :if ([:len \$a1] > 0) do={ /ip arp remove \$a1; :log info (\"drop-host-soft: ARP usuniƒôty dla IP \" . \$foundIP) } }\r\
:if ([:len \$foundMAC] > 0) do={ :local a2 [/ip arp find where mac-address=\$foundMAC]; :if ([:len \$a2] > 0) do={ /ip arp remove \$a2; :log info (\"drop-host-soft: ARP usuniƒôty dla MAC \" . \$foundMAC) } }\r\
\r\
<span class="comment"># B) DHCP lease</span>\r\
:if ([:len \$foundMAC] > 0) do={ :local d1 [/ip dhcp-server lease find where mac-address=\$foundMAC]; :if ([:len \$d1] > 0) do={ /ip dhcp-server lease remove \$d1; :log info (\"drop-host-soft: lease DHCP usuniƒôty (MAC) \" . \$foundMAC) } }\r\
:if ([:len \$foundIP] > 0) do={ :local d2 [/ip dhcp-server lease find where address=\$foundIP]; :if ([:len \$d2] > 0) do={ /ip dhcp-server lease remove \$d2; :log info (\"drop-host-soft: lease DHCP usuniƒôty (IP) \" . \$foundIP) } }\r\
\r\
<span class="comment"># C) Bridge host (L2)</span>\r\
:if ([:len \$foundMAC] > 0) do={ :local bh1 [/interface bridge host find where mac-address=\$foundMAC]; :if ([:len \$bh1] > 0) do={ /interface bridge host remove \$bh1; :log info (\"drop-host-soft: bridge-host usuniƒôty dla MAC \" . \$foundMAC) } }\r\
:if ([:len \$foundIP] > 0) do={ :local bh2 [/interface bridge host find where address=\$foundIP]; :if ([:len \$bh2] > 0) do={ /interface bridge host remove \$bh2; :log info (\"drop-host-soft: bridge-host usuniƒôty dla IP \" . \$foundIP) } }\r\
\r\
<span class="comment"># D) Conntrack (NAT/sesje)</span>\r\
:if ([:len \$foundIP] > 0) do={\r\
  :local c1 [/ip firewall connection find where src-address~(\\\"^\" . \$foundIP . \\\"(:|$)\\\")];\r\
  :if ([:len \$c1] > 0) do={ /ip firewall connection remove \$c1; :log info (\"drop-host-soft: conntrack rm src=\" . \$foundIP) }\r\
  :local c2 [/ip firewall connection find where dst-address~(\\\"^\" . \$foundIP . \\\"(:|$)\\\")];\r\
  :if ([:len \$c2] > 0) do={ /ip firewall connection remove \$c2; :log info (\"drop-host-soft: conntrack rm dst=\" . \$foundIP) }\r\
}\r\
\r\
<span class="comment"># E) BRAK permanent block - to jest r√≥≈ºnica od drop-host-v2!</span>\r\
\r\
:put (\"drop-host-soft: OK -> IP=\" . \$foundIP . \", MAC=\" . \$foundMAC . \" (SOFT - bez blokady)\")"</code>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>Dokumentacja wygenerowana:</strong> 2025-10-23</p>
            <p><strong>Script:</strong> drop-host-soft (MikroTik RouterOS 7.x)</p>
            <p style="margin-top: 15px; font-size: 0.9em;">
                <strong>PietrzakVLAN-Katowice</strong> | Network Maintenance Scripts
            </p>
            <p style="font-size: 0.85em; color: #999; margin-top: 10px;">
                ¬© 2025 | Katowice, ≈ölƒÖsk
            </p>
        </div>
    </div>
</body>
</html>
