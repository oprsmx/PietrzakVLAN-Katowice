
<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<title>Pietrzak‑VLAN — Adopcja nowych urządzeń UniFi (switch/AP)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root { --bg:#0b1320; --card:#101a2b; --text:#e9eef7; --muted:#a9b6cc; --accent:#4ea1ff; --ok:#42c27a; --warn:#ffb020; --bad:#ff5d5d; }
  html,body{background:var(--bg);color:var(--text);font:16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";margin:0}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px 64px}
  header{padding:24px 0 8px}
  h1{font-size:28px;margin:0 0 6px}
  h2{font-size:20px;margin:28px 0 10px}
  h3{font-size:16px;margin:18px 0 8px;color:var(--muted)}
  p{margin:8px 0}
  .card{background:var(--card);border:1px solid #1d2b45;border-radius:14px;padding:16px 18px;margin:14px 0}
  .kroki ol{margin:0 0 0 18px;padding:0}
  code,pre{background:#0c1526;border:1px solid #1a2946;padding:.15rem .4rem;border-radius:8px;color:#cfe3ff}
  .pill{display:inline-block;border-radius:999px;padding:2px 10px;font-size:12px;border:1px solid #243659;color:var(--muted);margin-right:6px}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .tip{border-left:3px solid var(--accent);padding-left:10px;color:var(--muted)}
  ul{margin:6px 0 6px 18px}
  .small{font-size:13px;color:var(--muted)}
  a{color:var(--accent);text-decoration:none}
  .tbl{width:100%;border-collapse:collapse;font-size:14px}
  .tbl th,.tbl td{border:1px solid #203357;padding:8px;text-align:left}
  .tbl th{background:#12203a}
</style>
</head>
<body>
<div class="wrap">
<header>
  <h1>Pietrzak‑VLAN — szybki przewodnik adopcji nowych urządzeń UniFi</h1>
  <p class="small">Zakres: Unifi USW (switche) oraz AP. Środowisko: VLAN1 = <b>UNIFI‑MGMT</b> (10.251.251.0/24), CloudKey 10.251.251.10, DHCP/ARP na Mikrotik, brama (DNS) na Forti.</p>
</header>

<section class="card">
  <h2>Faza 0 — checklist przed adopcją</h2>
  <div class="grid">
    <div>
      <h3>Warstwa fizyczna</h3>
      <ul>
        <li>Kabel do <b>USW‑Pro‑24 (Renault)</b>, port tymczasowy (np. 24).</li>
        <li>Port 25 (SFP+) to uplink do USW‑Aggregation — <i>nie zmieniamy</i>.</li>
      </ul>
    </div>
    <div>
      <h3>Warstwa L3</h3>
      <ul>
        <li>CloudKey/Controller: <code>10.251.251.10</code></li>
        <li>Forti brama/DNS: <code>10.251.251.1</code></li>
        <li>Mikrotik DHCP: <code>10.251.251.254</code></li>
      </ul>
    </div>
  </div>
</section>

<section class="card kroki">
  <h2>Faza 1 — Adopcja (czysty ACCESS do VLAN1)</h2>
  <ol>
    <li>W UniFi: <b>Devices → USW‑Pro‑24 (Renault) → Ports → [port tymczasowy, np. 24]</b>.</li>
    <li>Ustaw profil portu:
      <ul>
        <li><b>Port type:</b> Access</li>
        <li><b>Native VLAN / Network:</b> <code>UNIFI‑MGMT (10.251.251.0/24)</code></li>
        <li><b>Tagged VLANs:</b> <span class="pill">Block All</span></li>
      </ul>
    </li>
    <li>Podłącz nowe urządzenie (switch/AP). Po 15–60 s powinno pobrać IP <span class="ok">10.251.251.x</span>.</li>
    <li>W kontrolerze status przejdzie: <i>Pending</i> → <i>Adopting</i> → <i>Connected</i>.</li>
  </ol>
  <p class="tip"><b>Dlaczego tak?</b> Czysty ACCESS na VLAN1 eliminuje mieszanie broadcastów z innych VLAN‑ów. Błąd „Unable to resolve” zwykle wynika z pozostawienia <i>Allow All</i> na porcie adopcyjnym.</p>
</section>

<section class="card kroki">
  <h2>Faza 2 — Przestawienie uplinku na TRUNK (po adopcji)</h2>
  <ol>
    <li>Na <b>USW‑Pro‑24 (Renault)</b> — ten sam port (np. 24):</li>
    <ul>
      <li><b>Port type:</b> Trunk</li>
      <li><b>Native VLAN:</b> <code>UNIFI‑MGMT (1)</code></li>
      <li><b>Tagged VLANs:</b> <span class="pill">Allow All</span> (jak między USW‑Pro‑24 ↔ USW‑Aggregation)</li>
    </ul>
    <li>Na <b>nowym switchu</b> — port uplink (np. 1): ustaw identycznie: <b>Trunk</b>, Native=1, <b>Allow All</b>.</li>
    <li>Porty końcowe na nowym switchu ustawiaj już jako:
      <ul>
        <li><b>Access VLAN X</b> (np. Renault‑100, Ferrari‑110, IoT‑150), <b>Tagged VLANs: Block All</b>.</li>
      </ul>
    </li>
  </ol>
</section>

<section class="card">
  <h2>Szybkie testy i weryfikacja</h2>
  <div class="grid">
    <div>
      <h3>Mikrotik (DHCP)</h3>
      <pre>/ip dhcp-server lease print where address=10.251.251.249</pre>
      <p class="small">Sprawdź: <i>status=bound</i>, <i>server=dhcp_vlan1</i>.</p>
    </div>
    <div>
      <h3>Łączność</h3>
      <pre>ping 10.251.251.1    # Forti/DNS
ping 10.251.251.10   # CloudKey</pre>
      <p class="small">Brak odpowiedzi → sprawdź Native VLAN=1 i trunk <i>Allow All</i> na uplinkach.</p>
    </div>
  </div>
</section>

<section class="card">
  <h2>Najczęstsze problemy</h2>
  <table class="tbl">
    <thead><tr><th>Objaw</th><th>Przyczyna</th><th>Naprawa</th></tr></thead>
    <tbody>
      <tr>
        <td>„Unable to resolve” podczas adopcji</td>
        <td>Port adopcyjny zostawiony jako trunk / Allow All</td>
        <td>Ustaw ACCESS VLAN1 + <b>Block All</b> tagów, podłącz ponownie</td>
      </tr>
      <tr>
        <td>Jest IP, brak ping do 10.251.251.1</td>
        <td>Native VLAN ≠ 1 na którymś z uplinków</td>
        <td>Upewnij się: Native=1 na całej ścieżce do Forti/CloudKey</td>
      </tr>
      <tr>
        <td>Po adopcji brak VLAN‑ów na nowym switchu</td>
        <td>Uplink pozostał w trybie ACCESS</td>
        <td>Przestaw uplink po obu stronach na <b>TRUNK (Allow All, Native=1)</b></td>
      </tr>
      <tr>
        <td>CloudKey nie widzi urządzenia</td>
        <td>CloudKey nie jest w VLAN1 lub ma inny DNS</td>
        <td>CloudKey musi być w VLAN1 (10.251.251.10), DNS=Forti (10.251.251.1)</td>
      </tr>
    </tbody>
  </table>
</section>

<section class="card">
  <h2>Wzorce portów (skrót)</h2>
  <ul>
    <li><b>ACCESS‑MGMT:</b> VLAN1 (UNIFI‑MGMT), Tagged VLANs: Block All</li>
    <li><b>TRUNK‑ALL:</b> Native VLAN 1, Tagged VLANs: Allow All</li>
    <li><b>ACCESS‑VLAN‑X:</b> Native VLAN X, Tagged: Block All</li>
  </ul>
</section>

<footer class="small" style="margin-top:10px;color:#7f8aa3">
  <p>Dokument skrócony. Projekt: <b>Pietrzak‑VLAN</b>. Ostatnia aktualizacja: <script>document.write(new Date().toISOString().slice(0,10))</script>.</p>
</footer>
</div>
</body>
</html>
